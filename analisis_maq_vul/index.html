<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>2.Análisis de máquinas vulnerables - Documentación de la tarea RA2</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Documentación de la tarea RA2</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../trazado_vul/" class="nav-link">1.Trazado de vulnerabilidades</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">2.Análisis de máquinas vulnerables</a>
                            </li>
                            <li class="nav-item">
                                <a href="../comprobacion_req_seguridad/" class="nav-link">3.Comprobación de los requisistos de seguridad de una aplicación</a>
                            </li>
                            <li class="nav-item">
                                <a href="../reflexion/" class="nav-link">4.Reflexión</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../trazado_vul/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../comprobacion_req_seguridad/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#apartado-2-analisis-de-vulnerabilidad" class="nav-link">Apartado 2 - Análisis de vulnerabilidad</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#explotacion-de-la-vulnerabilidad" class="nav-link">Explotación de la vulnerabilidad</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#analisis-del-codigo-vulnerable" class="nav-link">Análisis del código vulnerable</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusion" class="nav-link">Conclusión</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="apartado-2-analisis-de-vulnerabilidad">Apartado 2 - Análisis de vulnerabilidad</h1>
<p>En este apartado, se analiza la vulnerabilidad <strong>“SQL Injection (GET/SEARCH)”</strong> de el entorno “bWAPP”. Concretamente, se centra en el análisis del código que permite esta vulnerabilidad se explotada por los atacantes. El despliegue de este entorno se realiza en una máquina virtual de Kali linux dentro de Docker.</p>
<hr />
<h3 id="identificacion-del-endpoint-vulnerable"><strong>Identificación del endpoint vulnerable</strong></h3>
<p>En la siguiente captura, podemos observar que hay un campo al cual podemos buscar diferentes nombres de películas. </p>
<p><img alt="" src="../img-2/inicio.png" /></p>
<p>Para comprobar la vulnerabilidad, introduciremos un carácter usado en las consultas de SQL para ver si nos da algún error.</p>
<p><img alt="" src="../img-2/inicio-vul.png" /></p>
<p>Concretamente nos da un error de sintaxis de SQL, por lo que significa que el carácter puesto esta realizando una función dentro de backend (concretamente cerrando una parte de la consulta cuando no debería).</p>
<hr />
<h2 id="explotacion-de-la-vulnerabilidad">Explotación de la vulnerabilidad</h2>
<p>Con la información anterior, podemos inyectar código sql a través del mismo input del html. Además, para que resulte algo más sencillo las pruebas, en la misma url podríamos meter todo nuestro código malicioso. </p>
<p>En este caso, muestro una simple inyección de sql que me permite listar todo el contenido esa tabla y ordenarlo por la columna del año.</p>
<p><img alt="" src="../img-2/injec-simple.png" /></p>
<hr />
<h2 id="analisis-del-codigo-vulnerable">Análisis del código vulnerable</h2>
<p>Si queremos acceder al código que contiene la vulnerabilidad de “Inyección de SQL”, tendremos que realizar los siguientes pasos: </p>
<h3 id="10-identificar-el-contenedor">1.0 Identificar el contenedor</h3>
<p>Una vez que tenemos nuestro entorno ejecutándose, debemos listar los contenedores activos:</p>
<pre><code class="language-python">docker ps
</code></pre>
<p><img alt="" src="../img-2/cont-act.png" /></p>
<p>Tras haber listado los contenedores, tenemos que identificar cual es. Para ello, buscar ver por el nombre de la imagen, la cual encontramos una llamada <strong>bwapp.</strong></p>
<p><img alt="" src="../img-2/cont-b.png" /></p>
<h3 id="20-acceder-a-la-terminal-de-este">2.0 Acceder a la terminal de este</h3>
<p>Para acceder a la terminal de este contenedor, <strong>debemos copiar el ID del contenedor de bwapp</strong> y ejecutar el siguiente comando:</p>
<pre><code class="language-python">docker exec -it ID_CONTENEDOR /bin/bash
</code></pre>
<p><img alt="" src="../img-2/ter-docker.png" /></p>
<h3 id="30-analisis-del-codigo">3.0 Análisis del código</h3>
<p>El primer código que analizaremos será: <strong>/var/www/html/sqli_1.php</strong></p>
<p><img alt="" src="../img-2/input-tittle.png" /></p>
<p>En la imagen anterior, podemos ver que el propio html identifica el texto que nosotros añadimos por el input como “tittle”.</p>
<p><img alt="" src="../img-2/php-tittle.png" /></p>
<p>Concretamente, podemos ver como se procesa esa variable que lleva nuestro código, por lo que podemos identificar que realiza varias validaciones:</p>
<ul>
<li>Comprueba que <strong>tittle</strong> no este vacía</li>
</ul>
<p><img alt="" src="../img-2/til-isset.png" /></p>
<ul>
<li>Justo antes de llamar a la consulta, <strong>tittle</strong> pasa por la función .sqli</li>
</ul>
<pre><code class="language-python">$sql = &quot;SELECT * FROM movies WHERE title LIKE '%&quot; . sqli($title) . &quot;%'&quot;;
</code></pre>
<ul>
<li>Esta función esta definida al principio del archivo y es la encargada de establecer el tipo procesador que se le dará a nuestra variable dependiendo del nivel de seguridad.</li>
</ul>
<p><img alt="" src="../img-2/fun-sqli.png" /></p>
<ul>
<li>En esta podemos ver que en función de nuestro nivel de seguridad, tendremos un tipo de filtro. Al ser un nivel de seguridad de bajo, en este caso es 0 y nuestro <strong>tittle,</strong> es enviado a la función <strong>no_check (la cual no realiza ninguna validación)</strong>.</li>
</ul>
<p><img alt="" src="../img-2/img-no-check.png" /></p>
<p>Entonces, podemos determinar que al no realizarse ninguna validación, el código que introduzcamos por el input, será procesado por el archivo de php analizado.</p>
<hr />
<h2 id="conclusion">Conclusión</h2>
<p>Toda esta información la podemos usar para realizar consultas a la base de datos perniciosas siempre y cuando nuestro nivel de seguridad sea bajo. Todo esto pueden llegar a vulnerar la máquina y comprometer la seguridad de la misma.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
